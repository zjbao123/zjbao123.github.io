---
title: 初探python(5)模块
date: 2016-09-26 20:14:50
tags: 
- python
- python教程
categories: 总结
---


随着代码越写越长，越不容易维护。为了编写可维护的代码，我们把很多函数分组，分别放到不同的文件里，这样件，每个文包含的代码就相对较少，很多编程语言都采用这种组织代码的方式。在Python中，一个.py文件就称之为一个模块（Module）。
<!-- more -->
## 模块的好处
1.大大提高了代码的可维护性。
2.编写代码不必从零开始。
3.使用模块还可以避免函数名和变量名冲突。即使变量名相同只要模块不同也没关系。

## 包
那如果有同名的模块怎么办？Python又引入了按目录来组织模块的方法，称为包（Package）。

可以通过包来组织模块，避免冲突。方法是选择一个顶层包名，引入了包以后，只要顶层的包名不与别人冲突，那所有模块都不会与别人冲突。假设包名为mycompany，那其中的abc.py模块的名字就变成了mycompany.abc。

请注意，每一个包目录下面都会有一个__init__.py的文件，这个文件是必须存在的，否则，Python就把这个目录当成普通目录，而不是一个包。__init__.py可以是空文件，也可以有Python代码，因为__init__.py本身就是一个模块，而它的模块名就是mycompany。

## 使用模块

Python本身就内置了很多非常有用的模块，我们可以立刻使用。

使用模块的第一步，就是`import`对应的模块。
```
import sys

```
这样就可以有了变量sys指向该模块，利用sys这个变量，就可以访问sys模块的所有功能。

sys模块有一个argv变量，用list存储了命令行的所有参数。argv至少有一个元素，因为第一个参数永远是该.py文件的名称，例如：

运行python hello.py获得的sys.argv就是['hello.py']；

运行python hello.py Michael获得的sys.argv就是['hello.py', 'Michael]
```
if __name__=='__main__':
    test()
```
Python解释器把一个特殊变量__name__置为__main__，而如果在其他地方导入该hello模块时，if判断将失败，因此，这种if测试可以让一个模块通过命令行运行时执行一些额外的代码，最常见的就是运行测试。

## 别名
导入模块时，还可以使用别名，这样，可以在运行时根据当前环境选择最合适的模块。也可以方便调用。
比如Python标准库一般会提供StringIO和cStringIO两个库，这两个库的接口和功能是一样的，但是cStringIO是C写的，速度更快，所以，你会经常看到这样的写法：
```
try:
    import cStringIO as StringIO
except ImportError: # 导入失败会捕获到ImportError
    import StringIO
```
即优先导入`cStringIO`。如果有些平台不提供`cStringIO`，还可以降级使用`StringIO`。

## 作用域
当然，我们也可以通过不同的命名方式来设置作用域来作用变量的使用范围。

正常的函数和变量名是公开的（public），可以被直接引用，比如：abc，x123，PI等；

类似`__xxx__`这样的变量是特殊变量，可以被直接引用，但是有特殊用途，但是有特殊用途，比如上面的`__author__`，`__name__`就是特殊变量，文档注释也可以用特殊变量`__doc__`访问，我们自己的变量一般不要用这种变量名。

类似`_xxx`和`__xxx`这样的函数或变量就是非公开的（private），不应该被直接引用，比如`_abc`，`__abc`等；

之所以我们说，private函数和变量“不应该”被直接引用，而不是“不能”被直接引用，是因为Python并没有一种方法可以完全限制访问private函数或变量，但是，从编程习惯上不应该引用private函数或变量。

## 安装第三方模块
在Python中，安装第三方模块，是通过setuptools这个工具完成的。Python有两个封装了setuptools的包管理工具：easy_install和pip。目前官方推荐使用pip。

要安装一个第三方库，必须先知道该库的名称，可以在官网或者pypi上搜索，比如Pillow，因此，安装Pillow的命令就是：

pip install Pillow
耐心等待下载并安装后，就可以使用Pillow了。

## 模块搜索路径
当我们试图加载一个模块时，Python会在指定的路径下搜索对应的.py文件，如果找不到，就会报错。

默认情况下，Python解释器会搜索当前目录、所有已安装的内置模块和第三方模块，搜索路径存放在sys模块的path变量中。

如果我们要添加自己的搜索目录，有两种方法：

1.直接修改`sys.path`。添加要搜索的目录:
```
import sys
sys.path.append('/Users/michael/my_py_scripts')
```

这种方法是在运行时修改，运行结束后失效。

2.设置环境变量`PYTHONPATH`，该环境变量的内容会被自动添加到模块搜索路径中。设置方式与设置Path环境变量类似。注意只需要添加你自己的搜索路径，Python自己本身的搜索路径不受影响。

## 使用`__future__`
Python的每个新版本都会增加一些新的功能，或者对原来的功能作一些改动。
要直接把代码升级到3.x是比较冒进的，因为有大量的改动需要测试。相反，可以在2.7版本中先在一部分代码中测试一些3.x的特性，如果没有问题，再移植到3.x不迟。

Python提供了`__future__`模块，把下一个新版本的特性导入到当前版本，于是我们就可以在当前版本中测试一些新版本的特性。
```
from __future__ import unicode_literals
```

由于Python是由社区推动的开源并且免费的开发语言，不受商业公司控制，因此，Python的改进往往比较激进，不兼容的情况时有发生。Python为了确保你能顺利过渡到新版本，特别提供了`__future__`模块，让你在旧的版本中试验新版本的一些特性。



>此python学习路径来源于[廖雪峰的Python教程](http://www.liaoxuefeng.com/wiki/001374738125095c955c1e6d8bb493182103fac9270762a000)的一个学习内容的总结。以便于自己后的学习和整理。